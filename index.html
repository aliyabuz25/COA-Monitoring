<!DOCTYPE html>
<html>
<head>
<title>COA Ultra Monitoring System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#eef2f5;}
.header{background:#1b5e20;color:white;padding:15px;text-align:center;font-size:18px;}
.login{display:flex;justify-content:center;align-items:center;height:90vh;}
.login-box{background:white;padding:25px;border-radius:8px;width:300px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.login-box input{width:100%;padding:8px;margin:10px 0;}
.login-box button{width:100%;padding:8px;background:#1b5e20;color:white;border:none;}
.dashboard{display:none;padding:15px;}
.card{background:white;padding:15px;margin-bottom:10px;border-radius:6px;box-shadow:0 3px 6px rgba(0,0,0,0.1);}
button{padding:6px 10px;margin:3px;border:none;background:#1b5e20;color:white;border-radius:4px;cursor:pointer;}
.late{color:red;font-weight:bold;}
.on-time{color:green;font-weight:bold;}
.submitted{color:blue;font-weight:bold;}
table{width:100%;border-collapse:collapse;background:white;}
th,td{padding:8px;border-bottom:1px solid #ddd;text-align:center;}
th{background:#2e7d32;color:white;}
.notification{float:right;}
.badge{background:red;color:white;padding:3px 7px;border-radius:50%;font-size:12px;}
.message{background:#f1f8e9;padding:8px;margin-top:5px;border-left:4px solid green;font-size:13px;}
.audit{font-size:12px;background:#fff3e0;padding:5px;margin:3px 0;}
</style>
</head>

<body>

<div class="header">
COA Ultra Monitoring & Compliance System
<span class="notification">ðŸ”” <span id="notifCount" class="badge">0</span></span>
</div>

<div class="login" id="loginPage">
    <div class="login-box">
        <h3>Login</h3>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>
</div>

<div class="dashboard" id="dashboard">

<div class="card">
Welcome: <b id="userLabel"></b>
<button onclick="logout()" style="float:right;">Logout</button>
</div>

<div id="adminPanel" style="display:none;" class="card">
<h3>Admin Controls</h3>
<button onclick="addReport()">Add Report</button>
<button onclick="sendReminder()">Send Reminder</button>
</div>

<div class="card">
<h3>Reports</h3>
<table id="table"></table>
</div>

<div class="card">
<h3>Inbox</h3>
<div id="inbox"></div>
</div>

<div class="card">
<h3>Audit Trail</h3>
<div id="auditLog"></div>
</div>

</div>

<script>

let users=[
{username:"admin",password:"1234",role:"admin"},
{username:"accounting",password:"1111",role:"unit"},
{username:"planning",password:"2222",role:"unit"},
{username:"construction",password:"3333",role:"unit"}
];

let reports=JSON.parse(localStorage.getItem("reports"))||[];
let messages=JSON.parse(localStorage.getItem("messages"))||[];
let audit=JSON.parse(localStorage.getItem("audit"))||[];

let currentUser="",role="";

function save(){
localStorage.setItem("reports",JSON.stringify(reports));
localStorage.setItem("messages",JSON.stringify(messages));
localStorage.setItem("audit",JSON.stringify(audit));
}

function logAction(text){
audit.push({text,date:new Date().toLocaleString()});
save();
}

function login(){
let u=document.getElementById("username").value;
let p=document.getElementById("password").value;
let found=users.find(x=>x.username===u && x.password===p);
if(found){
currentUser=u;
role=found.role;
document.getElementById("loginPage").style.display="none";
document.getElementById("dashboard").style.display="block";
document.getElementById("userLabel").innerText=currentUser;
if(role==="admin")document.getElementById("adminPanel").style.display="block";
render();
}else alert("Invalid login");
}

function logout(){location.reload();}

function addReport(){
let unit=prompt("Enter Unit (accounting/planning/construction)");
let date=prompt("Enter Due Date (YYYY-MM-DD)");
if(unit && date){
let today=new Date();
let due=new Date(date);
let status=today<=due?"On Time":"Late";
reports.push({unit,date,status,file:null});
logAction("Admin added report for "+unit);
save();
render();
}
}

function sendReminder(){
let unit=prompt("Enter Unit to remind:");
if(unit){
messages.push({to:unit,text:"Reminder: Please process your report immediately.",date:new Date().toLocaleString()});
logAction("Admin sent reminder to "+unit);
save();
render();
}
}

function submit(i){
reports[i].status="Submitted";
logAction(currentUser+" submitted report");
save();
render();
}

function uploadFile(i,input){
reports[i].file=input.files[0]?.name||null;
logAction(currentUser+" uploaded file "+reports[i].file);
save();
render();
}

function render(){
let table=document.getElementById("table");

table.innerHTML=`
<tr>
<th>Unit</th>
<th>Due Date</th>
<th>Status</th>
<th>Upload</th>
<th>Action</th>
</tr>`;

reports.forEach((r,i)=>{
if(role==="admin"||r.unit===currentUser){

let uploadCell = (role==="unit" && r.unit===currentUser)
? `<input type="file" onchange="uploadFile(${i},this)">`
: (r.file || "-");

let actionCell = (role==="unit" && r.unit===currentUser && r.status!=="Submitted")
? `<button onclick="submit(${i})">Submit</button>`
: "";

table.innerHTML+=`
<tr>
<td>${r.unit}</td>
<td>${r.date}</td>
<td class="${r.status==='Late'?'late':r.status==='On Time'?'on-time':'submitted'}">${r.status}</td>
<td>${uploadCell}</td>
<td>${actionCell}</td>
</tr>`;
}
});

renderInbox();
renderAudit();
updateNotif();
}

function renderInbox(){
let box=document.getElementById("inbox");
box.innerHTML="";
messages.filter(m=>m.to===currentUser).forEach(m=>{
box.innerHTML+=`<div class="message">${m.text}<br><small>${m.date}</small></div>`;
});
}

function renderAudit(){
let box=document.getElementById("auditLog");
box.innerHTML="";
audit.slice(-10).reverse().forEach(a=>{
box.innerHTML+=`<div class="audit">${a.text}<br><small>${a.date}</small></div>`;
});
}

function updateNotif(){
let count=messages.filter(m=>m.to===currentUser).length;
document.getElementById("notifCount").innerText=count;
}

</script>

</body>
</html>
